!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(require("util"),require("events")):"function"==typeof define&&define.amd?define(["util","events"],t):t(e.util,e.events)}(this,function(e,t){"use strict";e=e&&e.hasOwnProperty("default")?e.default:e,t=t&&t.hasOwnProperty("default")?t.default:t;var n="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function r(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function a(e,t){return e(t={exports:{}},t.exports),t.exports}var i=a(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var n=0;t.length>n;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var r={};function a(e){return"number"==typeof e&&e!=e?r:e}function i(e){return e===r?NaN:e}t.MapLike=function(){function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._keys=[],this._values=[],n.forEach(function(e){if(!Array.isArray(e))throw Error("should be `new MapLike([ [key, value] ])`");if(2!==e.length)throw Error("should be `new MapLike([ [key, value] ])`");t.set(e[0],e[1])})}return n(e,[{key:"entries",value:function(){var e=this;return this.keys().map(function(t){var n=e.get(t);return[i(t),n]})}},{key:"keys",value:function(){return this._keys.filter(function(e){return void 0!==e}).map(i)}},{key:"values",value:function(){return this._values.slice()}},{key:"get",value:function(e){var t=this._keys.indexOf(a(e));return-1!==t?this._values[t]:void 0}},{key:"has",value:function(e){return-1!==this._keys.indexOf(a(e))}},{key:"set",value:function(e,t){var n=this._keys.indexOf(a(e));return-1!==n?this._values[n]=t:(this._keys.push(a(e)),this._values.push(t)),this}},{key:"delete",value:function(e){var t=this._keys.indexOf(a(e));return-1!==t&&(this._keys.splice(t,1),this._values.splice(t,1),!0)}},{key:"clear",value:function(){return this._keys=[],this._values=[],this}},{key:"forEach",value:function(e,t){var n=this;this.keys().forEach(function(r){e(n.get(r),r,t||n)})}},{key:"size",get:function(){return this._values.filter(function(e){return void 0!==e}).length}}]),e}()});r(i);var o=a(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e){void 0===e&&(e={}),this.metadataMap=new i.MapLike,this.performance=e.performance||performance}return e.prototype.mark=function(e,t){if(this.performance.mark(e),t){var n=this.performance.getEntriesByName(e,"mark"),r=n[n.length-1];r&&this.metadataMap.set(r,t)}},e.prototype.getEntryMetadata=function(e){return this.metadataMap.get(e)},e.prototype.clearEntryMetadata=function(e){return this.metadataMap.delete(e)},e.prototype.clear=function(){return this.metadataMap.clear()},e}();t.PerformanceMetadataMarker=n});r(o);for(var s=o.PerformanceMetadataMarker,u=a(function(e){var t,n,r,a,i,o;"undefined"!=typeof performance&&null!==performance&&performance.now?e.exports=function(){return performance.now()}:"undefined"!=typeof process&&null!==process&&process.hrtime?(e.exports=function(){return(t()-i)/1e6},n=process.hrtime,a=(t=function(){var e;return 1e9*(e=n())[0]+e[1]})(),o=1e9*process.uptime(),i=a-o):Date.now?(e.exports=function(){return Date.now()-r},r=Date.now()):(e.exports=function(){return(new Date).getTime()-r},r=(new Date).getTime())}),f="undefined"==typeof window?n:window,c=["moz","webkit"],l="AnimationFrame",p=f["request"+l],h=f["cancel"+l]||f["cancelRequest"+l],_=0;!p&&2>_;_++)p=f[c[_]+"Request"+l],h=f[c[_]+"Cancel"+l]||f[c[_]+"CancelRequest"+l];if(!p||!h){var y=0,d=0,m=[];p=function(e){if(0===m.length){var t=u(),n=Math.max(0,1e3/60-(t-y));y=n+t,setTimeout(function(){var e=m.slice(0);m.length=0;for(var t=0;e.length>t;t++)if(!e[t].cancelled)try{e[t].callback(y)}catch(e){setTimeout(function(){throw e},0)}},Math.round(n))}return m.push({handle:++d,callback:e,cancelled:!1}),d},h=function(e){for(var t=0;m.length>t;t++)m[t].handle===e&&(m[t].cancelled=!0)}}var v=function(e){return p.call(f,e)};v.cancel=function(){h.apply(f,arguments)},v.polyfill=function(e){e||(e=f),e.requestAnimationFrame=p,e.cancelAnimationFrame=h};var k=a(function(e){e.exports="function"==typeof Object.create?function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}}),w=a(function(t){try{var n=e;if("function"!=typeof n.inherits)throw"";t.exports=n.inherits}catch(e){t.exports=k}}),g=t.EventEmitter;function b(e){if(!(this instanceof b))return new b(e);g.call(this),this.setUpdateInterval(e),this.__onRaf=this.__onRaf.bind(this),this.__fps=0,this.__total=0,this.__samples=0,this.__lastSample=this.__lastSampleBatch=performance.now(),v(this.__onRaf)}w(b,g),b.prototype.__onRaf=function(){var e=performance.now();if(this.__samples++,this.__total+=e-this.__lastSample,e-this.__lastSampleBatch>=this.__interval){var t=1e3/(this.__total/this.__samples);this.__fps!==(t=t>60?60:~~t)&&(this.__fps=t,this.emit("update",t)),this.__total=0,this.__samples=0,this.__lastSampleBatch=e}this.__lastSample=e,v(this.__onRaf)},b.prototype.setUpdateInterval=function(e){this.__interval="number"==typeof e&&e>0?e:1e3},b.prototype.get=function(){return this.__fps};var M=b;const x=new s;window.marker=x,(new M).on("update",function(e){x.mark("FPS",{details:{FPS:e}})});window.getFpsStats=(()=>{return performance.getEntriesByType("mark").map(e=>{const t=x.getEntryMetadata(e);return{type:e.name,timeStamp:e.startTime,meta:t}})})});
